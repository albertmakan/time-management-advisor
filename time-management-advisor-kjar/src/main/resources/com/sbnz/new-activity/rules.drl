package com.sbnz;

import com.sbnz.timemanagementadvisor.model.AdviceMessage;
import com.sbnz.timemanagementadvisor.model.DayTemplate;
import com.sbnz.timemanagementadvisor.model.Activity;
import com.sbnz.timemanagementadvisor.model.enums.ActivityContinuityType;
import com.sbnz.timemanagementadvisor.model.enums.MessageLevel;

import com.sbnz.timemanagementadvisor.utils.DateTimeUtils;
import com.sbnz.timemanagementadvisor.utils.SetUtils;

import java.time.LocalTime;
import java.time.Duration;
import java.time.LocalDateTime;
import java.time.LocalDate;


rule "Check overlap (ONE_TIME - ONE_TIME)"
    when
        $new: Activity(id == null, continuityType == ActivityContinuityType.ONE_TIME, $start: start, $end: end)
        $act: Activity(id != null, continuityType == ActivityContinuityType.ONE_TIME, 
                      DateTimeUtils.isOverlapping($start, $end, start, end))
        $msg: AdviceMessage(text == null)
    then
        $msg.setText("Overlaps with activity '"+$act.getTitle()+"'");
        $msg.setLevel(MessageLevel.WARN);
end


rule "Check overlap (PERIODIC - PERIODIC)"
    when
        $new: Activity(id == null, continuityType == ActivityContinuityType.PERIODIC, $start: start, $end: end, $forDays: forDays)
        $act: Activity(id != null, continuityType == ActivityContinuityType.PERIODIC, 
                      DateTimeUtils.isOverlapping($start, $end, start, end),
                      SetUtils.haveCommon($forDays, forDays),
                      DateTimeUtils.isOverlapping($start.toLocalTime(), $end.toLocalTime(), start.toLocalTime(), end.toLocalTime()))
        $msg: AdviceMessage(text == null)
    then
        $msg.setText("Overlaps with activity '"+$act.getTitle()+"'");
        $msg.setLevel(MessageLevel.WARN);
end


rule "Check enough time"
    when
        $new: Activity(id == null, continuityType == ActivityContinuityType.CONTINUAL, $start: start, end!=null, $end: end)

    then
        //$msg.setLevel(MessageLevel.WARN);
end


rule "Check contraints"
    when
        $new: Activity(id == null)
    then
        //$msg.setLevel(MessageLevel.ERROR);
end